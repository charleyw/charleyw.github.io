<!doctype html>



  


<html class="theme-next pisces use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta name="description" content="享受技术和编程带来的快乐">
<meta property="og:type" content="website">
<meta property="og:title" content="王超的技术博客">
<meta property="og:url" content="http://imchao.wang/index.html">
<meta property="og:site_name" content="王超的技术博客">
<meta property="og:description" content="享受技术和编程带来的快乐">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="王超的技术博客">
<meta name="twitter:description" content="享受技术和编程带来的快乐">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: '博主'
    }
  };
</script>




  <link rel="canonical" href="http://imchao.wang/"/>

  <title> 王超的技术博客 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-46801609-1', 'auto');
  ga('send', 'pageview');
</script>


  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?d589ef06c2d30f9bee9db8326816e3d0";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>








  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">王超的技术博客</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">享受技术和编程带来的快乐</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/12/25/use-react-implement-tabs-page/" itemprop="url">
                  用React实现点击切换的标签页
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2015-12-25T11:25:48+08:00" content="2015-12-25">
              2015-12-25
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="一、首先是Showcase"><a href="#一、首先是Showcase" class="headerlink" title="一、首先是Showcase"></a>一、首先是Showcase</h3><p></p><p data-height="268" data-theme-id="0" data-slug-hash="KVgNeK" data-default-tab="result" data-user="charleyw" class="codepen">See the Pen <a href="http://codepen.io/charleyw/pen/KVgNeK/" target="_blank" rel="external">react-tabs</a> by Wang Chao (<a href="http://codepen.io/charleyw" target="_blank" rel="external">@charleyw</a>) on <a href="http://codepen.io" target="_blank" rel="external">CodePen</a>.</p><p></p>
<script async src="//assets.codepen.io/assets/embed/ei.js"></script>

<h3 id="二、如何实现"><a href="#二、如何实现" class="headerlink" title="二、如何实现"></a>二、如何实现</h3><p>既然用React写，那么它就必然是一个组件，首先考虑你怎么使用这个组件，也就是这个组件的接口是怎么样的。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">&lt;TabsControl&gt;</div><div class="line">  &lt;Tab name=&quot;red&quot;&gt;</div><div class="line">    &lt;div className=&quot;red&quot;/&gt;</div><div class="line">  &lt;/Tab&gt;</div><div class="line">  &lt;Tab name=&quot;blue&quot;&gt;</div><div class="line">    &lt;div className=&quot;blue&quot;/&gt;</div><div class="line">  &lt;/Tab&gt;</div><div class="line">  &lt;Tab name=&quot;yellow&quot;&gt;</div><div class="line">    &lt;div className=&quot;yellow&quot;/&gt;</div><div class="line">  &lt;/Tab&gt;</div><div class="line">&lt;/TabsControl&gt;</div></pre></td></tr></table></figure>
<p>这个<code>TabsControl</code>作为父组件，它来控制<code>Tab</code>的如何切换，<code>Tab</code>是用来包裹真正要显示的内容的，它的<code>name</code>属性是这个标签页的名字，会被显示在标签页的标题栏上。</p>
<h3 id="三、创建基本元素"><a href="#三、创建基本元素" class="headerlink" title="三、创建基本元素"></a>三、创建基本元素</h3><p>按照之前的想法，我们用<code>Tab</code>定义了很多个标签页，我们需要根据这些定义生成标签页的标题栏和内容。</p>
<h4 id="1-遍历this-props-children动态生成标题栏"><a href="#1-遍历this-props-children动态生成标题栏" class="headerlink" title="1. 遍历this.props.children动态生成标题栏"></a>1. 遍历<code>this.props.children</code>动态生成标题栏</h4><p><code>this.props.children</code>是React内建的一个属性，用来获取组件的子元素。因为子元素有可能是Object或者Array，所以React提供了一些处理children的辅助方法用来遍历：<code>React.Children.map</code></p>
<p>那么动态生成标题的代码可能是这样子的：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">React.Children.map(this.props.children, (element, index) =&gt; &#123;</div><div class="line">	return (&lt;div className=&quot;tab-title-item&quot;&gt;&#123;element.props.name&#125;&lt;/div&gt;)</div></pre></td></tr></table></figure>
<h4 id="2-再用同样方法生成标签页内容"><a href="#2-再用同样方法生成标签页内容" class="headerlink" title="2. 再用同样方法生成标签页内容"></a>2. 再用同样方法生成标签页内容</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">React.Children.map(this.props.children, element =&gt; &#123;</div><div class="line">	return (element)</div><div class="line">&#125;)</div></pre></td></tr></table></figure>
<p>组合起来就是<code>TabsControl</code>的实现：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">let TabsControl = React.createClass(&#123;</div><div class="line">  render: function () &#123;</div><div class="line">    let that = this;</div><div class="line">    let &#123;baseWidth&#125; = this.props;</div><div class="line">    let childrenLength = this.props.children.length;</div><div class="line">    return (</div><div class="line">      &lt;div&gt;</div><div class="line">        &lt;nav className=&quot;tab-title-items&quot;&gt;</div><div class="line">          &#123;React.Children.map(this.props.children, (element, index) =&gt; &#123;</div><div class="line">            return (&lt;div className=&quot;tab-title-item&quot;&gt;&#123;element.props.name&#125;&lt;/div&gt;)</div><div class="line">          &#125;)&#125;</div><div class="line">        &lt;/nav&gt;</div><div class="line">        &lt;div className=&quot;tab-content-items&quot;&gt;</div><div class="line">          &#123;React.Children.map(this.props.children, element =&gt; &#123;</div><div class="line">            return (element)</div><div class="line">          &#125;)&#125;</div><div class="line">        &lt;/div&gt;</div><div class="line">      &lt;/div&gt;</div><div class="line">    )</div><div class="line">  &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>加上一些css就能看到一个标签页的雏形了。</p>
<h3 id="三、实现标签页切换"><a href="#三、实现标签页切换" class="headerlink" title="三、实现标签页切换"></a>三、实现标签页切换</h3><p>这里要出现React最重要的概念了<code>state</code>，<code>state</code>是一个Javascript的Object，它是用来表示组件的当前状态的，如果用<code>TabsControl</code>举例的话，它的<code>state</code>可以是当前处于激活状态的标签页编号（当然，如果你想的话也可以保存标签页的内容）。<br>React提供了一个方法<code>setState()</code>让你可以改变<code>state</code>的值。每次调用<code>setState()</code>都会触发组件的<code>render()</code>，也就是说会把组件所代表的DOM更新到<code>state</code>所代表的状态。</p>
<p>所以实现切换的关键如下：</p>
<ol>
<li><code>state</code>保存当前处于激活状态的标签页的编号</li>
<li>点击标题的时候调用<code>setState()</code>更新激活的标签页编号</li>
<li><code>render()</code>的时候，在遍历<code>this.props.children</code>的时候把编号与<code>state</code>中编号一致的元素标记为<code>active</code></li>
<li>用css将非<code>active</code>的元素隐藏起来</li>
</ol>
<p>所以代码是这样的：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line">let TabsControl = React.createClass(&#123;</div><div class="line">  getInitialState: function()&#123;</div><div class="line">    return &#123;currentIndex: 0&#125;</div><div class="line">  &#125;,</div><div class="line">  </div><div class="line">  getTitleItemCssClasses: function(index)&#123;</div><div class="line">    return index === this.state.currentIndex ? &quot;tab-title-item active&quot; : &quot;tab-title-item&quot;;</div><div class="line">  &#125;,</div><div class="line">  </div><div class="line">  getContentItemCssClasses: function(index)&#123;</div><div class="line">    return index === this.state.currentIndex ? &quot;tab-content-item active&quot; : &quot;tab-content-item&quot;;</div><div class="line">  &#125;,</div><div class="line">  </div><div class="line">  render: function()&#123;</div><div class="line">    let that = this;</div><div class="line">    let &#123;baseWidth&#125; = this.props;</div><div class="line">    let childrenLength = this.props.children.length;</div><div class="line">    return (</div><div class="line">      &lt;div&gt;</div><div class="line">        &lt;nav className=&quot;tab-title-items&quot;&gt;</div><div class="line">          &#123;React.Children.map(this.props.children, (element, index) =&gt; &#123;</div><div class="line">            return (&lt;div onClick=&#123;() =&gt; &#123;this.setState(&#123;currentIndex: index&#125;)&#125;&#125; className=&#123;that.getTitleItemCssClasses(index)&#125;&gt;&#123;element.props.name&#125;&lt;/div&gt;)</div><div class="line">          &#125;)&#125;</div><div class="line">        &lt;/nav&gt;</div><div class="line">        &lt;div className=&quot;tab-content-items&quot;&gt;</div><div class="line">          &#123;React.Children.map(this.props.children, (element, index) =&gt; &#123;</div><div class="line">            return (&lt;div className=&#123;that.getContentItemCssClasses(index)&#125;&gt;&#123;element&#125;&lt;/div&gt;)</div><div class="line">          &#125;)&#125;  </div><div class="line">        &lt;/div&gt;</div><div class="line">      &lt;/div&gt;</div><div class="line">    )</div><div class="line">  &#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p><code>getInitialState</code>：是组件的初始化状态，默认是第一个标签页处于激活状态。<br><code>getTitleItemCssClasses</code>：判断当前标签和<code>state</code>中保存的标签编号是否一直，是则标识为<code>active</code>。<br><code>getContentItemCssClasses</code>：同上。<br><code>onClick={() =&gt; {this.setState({currentIndex: index})}}</code>：标签页标题绑定了点击事件，每次点击都会更新<code>state</code>保存的标签页编号，然后触发<code>render()</code>方法重绘标签页。  </p>
<h3 id="四、总结"><a href="#四、总结" class="headerlink" title="四、总结"></a>四、总结</h3><p>上面一系列的操作最终的结果都需要用<code>render()</code>来反应出来，所以关键点是如何在<code>render()</code>中使用<code>state</code>来动态生成DOM.</p>
<h4 id="接下来的改进"><a href="#接下来的改进" class="headerlink" title="接下来的改进"></a>接下来的改进</h4><p>实现可以滑动的标签页</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/12/25/integrate-alipy-with-cordova-app/" itemprop="url">
                  Cordova集成支付宝支付
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2015-12-25T10:17:05+08:00" content="2015-12-25">
              2015-12-25
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="申请帐号"><a href="#申请帐号" class="headerlink" title="申请帐号"></a>申请帐号</h3><p>首先你需要从这个网站<a href="https://b.alipay.com/newIndex.htm" target="_blank" rel="external">支付宝商家页面</a>申请帐号，然后申请<a href="https://b.alipay.com/order/productDetail.htm?productId=2015110218010538" target="_blank" rel="external">无线支付</a>。</p>
<p>中间需要经历实名认证，对公帐号认证等等认证，全部成功之后会收到短信通知告诉你预约成功。</p>
<h3 id="上传RSA公钥"><a href="#上传RSA公钥" class="headerlink" title="上传RSA公钥"></a>上传RSA公钥</h3><ul>
<li>按照这个<a href="http://doc.open.alipay.com/doc2/detail.htm?spm=0.0.0.0.WSkmo8&amp;treeId=58&amp;articleId=103242&amp;docType=1" target="_blank" rel="external">网页</a>的说明生成RSA公钥<br><strong>注意</strong>：在<code>pkcs8 -topk8 -inform PEM -in rsa_private_key.pem -outform PEM -nocrypt</code>这一步会将生成的PKCS8格式的私钥打印到屏幕，需要手动保存。之后需要使用。</li>
<li>然后把生成好的RSA公钥上传到这个支付宝上，参照这个<a href="http://doc.open.alipay.com/doc2/detail.htm?spm=0.0.0.0.KOQ7dv&amp;treeId=58&amp;articleId=103578&amp;docType=1" target="_blank" rel="external">网页</a></li>
</ul>
<p><strong>注意上传的时候记住删掉公钥文件前后的—–BEGIN PUBLIC KEY—–和—–END PUBLIC KEY—–，以及空格和换行，否则会告诉你公钥非法</strong></p>
<h3 id="准备好集成资料"><a href="#准备好集成资料" class="headerlink" title="准备好集成资料"></a>准备好集成资料</h3><ul>
<li>支付宝帐号</li>
<li>合作者身份ID(PID): <a href="http://doc.open.alipay.com/doc2/detail?treeId=58&amp;articleId=103544&amp;docType=1" target="_blank" rel="external">查看方法</a></li>
<li>刚才生成的PKCS8格式的私钥：rsa_private_key.pem</li>
</ul>
<h3 id="集成Cordova支付宝插件-cordova-plugin-alipay"><a href="#集成Cordova支付宝插件-cordova-plugin-alipay" class="headerlink" title="集成Cordova支付宝插件 cordova-plugin-alipay"></a>集成Cordova支付宝插件 <a href="https://github.com/charleyw/cordova-plugin-alipay.git" target="_blank" rel="external">cordova-plugin-alipay</a></h3><p>以下以Mac系统为例</p>
<ol>
<li><p>使用git命令将插件下载到本地，并标记为$CORDOVA_PLUGIN_DIR</p>
<pre><code>git clone https://github.com/charleyw/cordova-plugin-alipay.git &amp;&amp; cd cordova-plugin-alipay &amp;&amp; export CORDOVA_PLUGIN_DIR=$(pwd)
</code></pre></li>
<li><p>修改$CORDOVA_PLUGIN_DIR/plugin.xml，将</p>
<pre><code>&lt;preference name=&quot;private_key&quot; value=&quot;$PRIVATE_KEY&quot; /&gt;
</code></pre><p>改成</p>
<pre><code>&lt;preference name=&quot;PRIVATE_KEY&quot; value=&quot;你生成的PKCS8格式的私钥&quot;/&gt;
</code></pre><p> <strong>注意</strong>：注意和公钥一样，需要去掉—–BEGIN PUBLIC KEY—–和—–END PUBLIC KEY—–，以及空格和换行</p>
</li>
<li><p>安装</p>
<pre><code>cordova plugin add $CORDOVA_PLUGIN_DIR --variable PARTNER_ID=[合作者身份ID(PID)] --variable SELLER_ACCOUNT=[你的商户支付宝帐号]
</code></pre></li>
</ol>
<p>安装成功之后剩下的就是编程的问题了。</p>
<h3 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">window.alipay.pay(&#123;</div><div class="line">	tradeNo: tradeNo,</div><div class="line">	subject: &quot;测试标题&quot;,</div><div class="line">	body: &quot;我是测试内容&quot;,</div><div class="line">	price: 0.02,</div><div class="line">	fromUrlScheme: &quot;demoScheme://afterPaymentSuccess&quot;,</div><div class="line">	notifyUrl: &quot;http://your.server.notify.url&quot;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<ul>
<li>tradeNo 这个是支付宝需要的，应该是一个唯一的ID号</li>
<li>subject 这个字段会显示在支付宝付款的页面</li>
<li>body 订单详情，没找到会显示哪里</li>
<li>price 价格，支持两位小数</li>
<li>fromUrlScheme 支付完成跳转的URL Scheme（<a href="https://developer.apple.com/library/ios/documentation/iPhone/Conceptual/iPhoneOSProgrammingGuide/Inter-AppCommunication/Inter-AppCommunication.html" target="_blank" rel="external">iOS</a>，<a href="http://developer.android.com/training/basics/intents/filters.html" target="_blank" rel="external">Android</a>），可以使用这个<a href="https://github.com/EddyVerbruggen/Custom-URL-scheme" target="_blank" rel="external">Cordova插件</a>定义你的App的Scheme</li>
</ul>
<p>调用<code>pay</code>方法会打开支付宝支付页面进行支付（如果有安装支付宝钱包的话会打开支付宝钱包），支付完成之后会跳回到程序，会跳到<code>fromUrlScheme</code>定义的程序页面，<br>如上面的例子会返回你的程序的<code>/afterPaymentSuccess</code>路径所定义的页面，并且支付结果会附加到这个url后面。你可以在程序中调试来确定该怎么处理。</p>
<p><strong>注意</strong>：因为插件的作者比较懒一直没有加回掉函数（所以需要使用URL Scheme来返回结果），所以使用这个插件的基本条件是：1. 使用URL Scheme， 2. 你的应用有路由或类似的东西来代表页面状态(即可以通过URL跳转到某个页面)，因为支付成功之后会跳转到这个页面。</p>
<p>祝大家好运！</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/08/16/android-ci-environment/" itemprop="url">
                  构建Android持续集成环境
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2015-08-16T08:36:32+08:00" content="2015-08-16">
              2015-08-16
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/android-CI-持续集成/" itemprop="url" rel="index">
                    <span itemprop="name">android, CI, 持续集成</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>本文的主要内容是如何用脚本在服务器上创建一个基于gradle的Android构建环境。</p>
<h1 id="目标操作系统"><a href="#目标操作系统" class="headerlink" title="目标操作系统"></a>目标操作系统</h1><ul>
<li>Ubuntu 14.04<br>ps: 基本上Linux都适用，不过只在Ubuntu和CentOS上测试过。</li>
</ul>
<h1 id="依赖的软件"><a href="#依赖的软件" class="headerlink" title="依赖的软件"></a>依赖的软件</h1><ul>
<li>Java</li>
<li>Android SDK</li>
</ul>
<h2 id="安装Oracle-JDK"><a href="#安装Oracle-JDK" class="headerlink" title="安装Oracle JDK"></a>安装Oracle JDK</h2><p>这里我安装的JDK8，我使用的安装方法是相对来说比较绿色的</p>
<h3 id="下载Oracle-JDK8"><a href="#下载Oracle-JDK8" class="headerlink" title="下载Oracle JDK8"></a>下载Oracle JDK8</h3><pre><code>wget --no-cookies --no-check-certificate --header &apos;Cookie: oraclelicense=accept-securebackup-cookie&apos;  -O &apos;jdk-8-linux-x64.tgz&apos; &apos;http://download.oracle.com/otn-pub/java/jdk/8u45-b14/jdk-8u45-linux-x64.tar.gz&apos;
</code></pre><h3 id="安装JDK"><a href="#安装JDK" class="headerlink" title="安装JDK"></a>安装JDK</h3><pre><code>tar zxf /var/tmp/jdk-8-linux-x64.tgz -C /var/tmp
</code></pre><p>注意：这个包解压出来的根目录叫做 <strong>jdk1.8.0_45</strong><br>注意：鉴于我的使用场景，每一次构建我都需要重建我的环境，因此我在这里把JDK解压到/var/tmp，你可以替换成其他文件夹，下同。</p>
<h3 id="如何使用JDK"><a href="#如何使用JDK" class="headerlink" title="如何使用JDK"></a>如何使用JDK</h3><p>尚且把这种安装方式叫做绿色安装好了，只需要每次使用Java之前设置JAVA_HOME就可以使用了。<br>在上一步中，解压好的JDK的全路径是 <strong>/var/tmp/jdk1.8.0_45</strong>，因此可以这样设置<strong>JAVA_HOME</strong>和<strong>Java</strong>相关的bin</p>
<pre><code>export JAVA_HOME=/var/tmp/jdk1.8.0_45
export PATH=${JAVA_HOME}/bin:${PATH}
</code></pre><p>如果想要一劳永逸的话，需要把上面两个export加到~/.bashrc中或者创建一个profile，如下：</p>
<pre><code>sudo tee -a /etc/profile.d/jdk1.8.sh &lt;&lt; &quot;EOF&quot;
export JAVA_HOME=/var/tmp/jdk1.8.0_45
export PATH=${JAVA_HOME}/bin:${PATH}
EOF
</code></pre><h2 id="安装Android-SDK"><a href="#安装Android-SDK" class="headerlink" title="安装Android SDK"></a>安装Android SDK</h2><h3 id="下载及解压"><a href="#下载及解压" class="headerlink" title="下载及解压"></a>下载及解压</h3><pre><code>wget -O /var/tmp/android-sdk.tgz http://dl.google.com/android/android-sdk_r24.2-linux.tgz
tar zxvf /var/tmp/android-sdk.tgz -C /var/tmp/
export ANDROID_HOME=/var/tmp/android-sdk-linux
</code></pre><p>Android SDK也被解压到了/var/tmp，你可以换成其他的目录，但是要注意权限问题。</p>
<h3 id="安装需要的SDK和相关工具"><a href="#安装需要的SDK和相关工具" class="headerlink" title="安装需要的SDK和相关工具"></a>安装需要的SDK和相关工具</h3><pre><code>echo y | ${ANDROID_HOME}/tools/android update sdk -s -u -a -t 7,24,139,140
</code></pre><p>前面的<code>echo y</code>是为了在在安装过程中同意Android License。<br>后面的数字，代表的是各个软件，如：</p>
<ul>
<li>7: Android SDK Build-tools, revision 21.1.2</li>
<li>24: SDK Platform Android 5.1.1, API 22, revision 2</li>
<li>139: Android Support Repository, revision 15</li>
<li>140: Android Support Library, revision 22.2</li>
</ul>
<p>这些代号需要使用下面的命令查看：</p>
<pre><code>${ANDROID_HOME}/tools/android list sdk --all
</code></pre><h2 id="64位操作系统"><a href="#64位操作系统" class="headerlink" title="64位操作系统"></a>64位操作系统</h2><p>如果是64位的操作系统，还需要执行下面的命令。</p>
<pre><code>dpkg --add-architecture i386
apt-get -qqy update
apt-get -qqy install libncurses5:i386 libstdc++6:i386 zlib1g:i386
</code></pre><p>到这里基本就可以进行构建了。</p>
<h2 id="栗子：在daocloud-io上构建Android应用"><a href="#栗子：在daocloud-io上构建Android应用" class="headerlink" title="栗子：在daocloud.io上构建Android应用"></a>栗子：在daocloud.io上构建Android应用</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">image: ubuntu:14.04</div><div class="line"></div><div class="line">env:</div><div class="line">    - DEPENDENCY_DIR=/var/tmp</div><div class="line">    - JAVA_HOME=$&#123;DEPENDENCY_DIR&#125;/jdk1.8.0_45</div><div class="line">    - ANDROID_HOME=$&#123;DEPENDENCY_DIR&#125;/android-sdk-linux</div><div class="line">    - PATH=$&#123;JAVA_HOME&#125;/bin:$&#123;PATH&#125;</div><div class="line"></div><div class="line">install:</div><div class="line">    - dpkg --add-architecture i386</div><div class="line">    - apt-get -qqy update</div><div class="line">    - &quot;apt-get install -y git wget libncurses5:i386 libstdc++6:i386 zlib1g:i386&quot;</div><div class="line">    - &quot;wget --no-cookies --no-check-certificate --header &apos;Cookie: oraclelicense=accept-securebackup-cookie&apos; -O $&#123;DEPENDENCY_DIR&#125;/jdk-8-linux-x64.tgz &apos;http://download.oracle.com/otn-pub/java/jdk/8u45-b14/jdk-8u45-linux-x64.tar.gz&apos;&quot;</div><div class="line">    - tar zxf $&#123;DEPENDENCY_DIR&#125;/jdk-8-linux-x64.tgz -C $&#123;DEPENDENCY_DIR&#125;</div><div class="line">    - wget -O $&#123;DEPENDENCY_DIR&#125;/android-sdk.tgz http://dl.google.com/android/android-sdk_r24.2-linux.tgz</div><div class="line">    - tar zxvf $&#123;DEPENDENCY_DIR&#125;/android-sdk.tgz -C $&#123;DEPENDENCY_DIR&#125;</div><div class="line">    - echo y | $&#123;ANDROID_HOME&#125;/tools/android update sdk -s -u -a -t 7,24,139,140</div><div class="line"></div><div class="line">script:</div><div class="line">    - ./gradlew assemble</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2014/02/21/make-your-service-autostart-on-linux/" itemprop="url">
                  在CentOS下配置自启动服务
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2014-02-21T16:33:09+08:00" content="2014-02-21">
              2014-02-21
            </time>
          </span>

          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>这里主要想介绍一下用<code>chkconfig</code>配置自启动服务，包括如何控制服务启动顺序以及启动依赖。虽然本文中提到的脚本的测试环境都是在CentOS上，但是因为使用的配置文件是<a href="http://en.wikipedia.org/wiki/Linux_Standard_Base" target="_blank" rel="external"><strong>LSB-style</strong></a>的，所以在其他Linux上也基本能用，只是使用的工具不一样，如在debian上使用<code>update-rc.d</code>。首先从如何简单的添加一个自启动服务说起。</p>
<h2 id="如何添加一个自启动服务"><a href="#如何添加一个自启动服务" class="headerlink" title="如何添加一个自启动服务"></a>如何添加一个自启动服务</h2><ol>
<li><p>首先，你需要一个服务配置脚本，在/etc/init.d下面创建一个文件，如test-init</p>
<pre><code>touch /etc/init.d/test-init
chmod +x /etc/init.d/test-init
</code></pre><p> 给这个文件写入如下内容</p>
<pre><code>#!/bin/sh

# chkconfig: 2345 20 80
# description: Saves and restores system entropy pool for \
#              higher quality random number generation.
</code></pre></li>
</ol>
<pre><code>    case &quot;$1&quot; in
      start)
            echo &quot;start testinit&quot; &gt;&gt; /root/test.init
            ;;
      stop)
            echo &quot;stop testinit&quot; &gt;&gt; /root/test.init
            ;;
      restart)
            echo &quot;restart testinit&quot; &gt;&gt; /root/test.init
            ;;
      *)
            echo &quot;Usage: $SCRIPT_NAME {start|stop|restart}&quot; &gt;&amp;2
            exit 3
            ;;
    esac
* 首先是前两行注释的内容，看起来是注释，其实是chkconfig的配置，第一行

        chkconfig: 2345 20 80


    * 这一行指定了这个脚本在哪几个[Run level](http://en.wikipedia.org/wiki/Runlevel)运行，这里是2345，就是在2345这个几个run level都会启动这个脚本。20 80分别指的启动的优先级和结束的优先级。  
    * 第二行是描述。

* 接下来的case语句是这个脚本所支持的操作，基本上你至少得支持start和stop，否则启动时会报错，在这个脚本中支持了3个操作：start，stop和restart。
</code></pre><ol>
<li><p>使用chkconfig设置这个脚本自启动：</p>
<pre><code>chkconfig --add test-init
</code></pre></li>
<li><p>检查一下看成功没有：</p>
<ul>
<li><p>第一种检查方法：</p>
<pre><code>chkconfig
</code></pre><p>  应该会输出下面的内容：        </p>
<blockquote>
<p>…<br>test-init          0:off    1:off    2:on    3:on    4:on    5:on    6:off<br>…</p>
</blockquote>
</li>
</ul>
</li>
</ol>
<pre><code>* 第二种：

        ls -l /etc/rc3.d/ | grep test-init

    应该会输出如下内容

    &gt;lrwxrwxrwx  1 root root 19 Feb 21 15:32 S20test-init -&gt; ../init.d/test-init

    这里我们只检查了/etc/rc3.d，它存储了run level 3要启动服务的列表。类似的文件夹还有rc0.d, rc1.d, rc2.d, rc4.d, rc5.d, rc6.d，分别对应于相应的run level。这些文件夹里面存储的文件都是对应启动脚本的链接。这些文件的名字遵守固定的规则：

    &gt;[S或者K][优先级][服务名称]

    系统启动时会按照优先级从小到大执行S开头的脚本的start方法，如对于`S20test-init`就会类似执行这个操作：

        /etc/rc3.d/S20test-init start

    系统关闭时会按照优先级顺序（方向不确定，有兴趣可以自己去验证一下）执行K开头的脚本的stop方法。
</code></pre><h2 id="如何控制启动顺序"><a href="#如何控制启动顺序" class="headerlink" title="如何控制启动顺序"></a>如何控制启动顺序</h2><p>实际上在上面的例子中，我们已经通过chkconfig配置了该服务的优先级，即设定了它在所有服务中的启动顺序：</p>
<pre><code>chkconfig: 2345 20 80
</code></pre><p>如果我们想让这个服务晚点执行，就可以把启动的优先级改低一点，把20往大了改就可以推迟该服务的启动时间。</p>
<p>当我们有复杂的服务启动依赖关系的时候，比如你的rails应用必须在mysql和邮件服务启动之后才能启动。用上面的这种方法就比较麻烦了。下面介绍另一种设置启动依赖的方法。</p>
<h3 id="使用LSB-init-script设置服务的依赖关系"><a href="#使用LSB-init-script设置服务的依赖关系" class="headerlink" title="使用LSB init script设置服务的依赖关系"></a>使用LSB init script设置服务的依赖关系</h3><p>这种配置文件在linux下是通用的，CentOS，Debian，Ubuntu，OpenSUSE以及RedHat都是支持的。</p>
<pre><code>### BEGIN INIT INFO
# Provides:       test-init
# Required-Start: mysql postfix
# Required-Stop:  
# Default-Start:  2 3 4 5
# Default-Stop:   0 1 6
# Description:    This is a test script
### END INIT INFO
</code></pre><ul>
<li><strong>Provides</strong>: 指明这个服务提供那些功能，可以定义多个。实际上可以看做是一些变量，当这个服务启动之后，就可以认为这些变量已经存在了，然后其他服务可以依赖于这些变量的存在性判断是否启动。</li>
<li><strong>Required-Start</strong>: 指明这个服务依赖的功能，可以依赖多个。当被依赖的服务出现后，才启动这个服务。不定义任何值的话，就意味着这个脚本可以在系统引导以后直接启动。</li>
<li><strong>Required-Stop</strong>: 同上，不过是停止服务。</li>
<li><strong>Default-Start</strong>: 在哪些run level启动。</li>
<li><strong>Default-Start</strong>: 在哪些run level停止。</li>
</ul>
<p>把这段配置内容添加到上面脚本的开始位置，再使用chkconfig配置这个脚本：</p>
<pre><code>chkconfig --del test-init
chkconfig --add test-init
</code></pre><p>之后可以使用下面的命令查看一下服务启动的列表：</p>
<pre><code>ls -l /etc/rc3.d/
</code></pre><p>可以发现<em><strong>S[优先级]test-init</strong></em>排在<em><strong>S[优先级]mysql</strong></em>和<em><strong>S[优先级]postfix</strong></em>之后。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>LSB init script基本上是通用的，在大部分linux上都可以使用。如果不是要启动服务，而是要在启动的时候执行某些命令的话，可以直接写到/etc/rc.local里面，它会在所有服务启动之后执行。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2014/01/02/make-you-raspberrypi-auto-connect-to-wifi/" itemprop="url">
                  让你的树莓派连上WiFi
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2014-01-02T13:02:02+08:00" content="2014-01-02">
              2014-01-02
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/raspberrypi/" itemprop="url" rel="index">
                    <span itemprop="name">raspberrypi</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>周一的时候树莓派总算是到手了，很早之前就了解过了，心里长草很多年，但就是一直没出手。最近在搞Arduino的小玩意，我们做的这个东西需要网络通信（一个可以远程控制的机器人小车），必须要借助上位机（一台android手机）的网络来接受命令，真想再给它再上一块WiFi扩展板，把手机扔了。然后就突然想起了这货，<a href="http://zh.wikipedia.org/wiki/%E6%A0%91%E8%8E%93%E6%B4%BE" target="_blank" rel="external">树莓派</a>是<strong>基于linux</strong>的只有信用卡的大小计算机。你可以把这货当成一个正常linux服务器就是，基本上你平时在linux上能做到的事情，它都能做到，比如当成rails服务器，在上面运行rails程序什么的(不过我没试，应该是可以的，sinatra可以)。然后这货有usb口，再然后插上你在某宝买的usb无线网卡，它就可以用WiFi了。下面是我第一次，第二次以及第n次连上WiFi的过程。</p>
<h3 id="第一次连上WiFi"><a href="#第一次连上WiFi" class="headerlink" title="第一次连上WiFi"></a>第一次连上WiFi</h3><p>第一次连wifi之前，你需要做一件事情，那就是打开树莓派的terminal（俗称命令行），你有两种选择：</p>
<ul>
<li>通过HDMI连个显示器，再接个USB接个键盘，然后你就可以像用一台普通的pc一样用树莓派了</li>
<li><p>插个网线，通过树莓派的ip地址ssh进去。</p>
<pre><code>ssh pi@your_raspi_ip
#password: raspberry
</code></pre></li>
</ul>
<p>我是通过插网线的方式进去的，这个方法比较麻烦的地方是，你得去找到树莓派从DHCP的获取到的ip(当然能设静态ip又是另一回事了)。我是在自己家连的时候，可以从路由器的客户端列表里面找到树莓派的ip。</p>
<p>在进到terminal后，你就可以开始安装软件，修改配置了</p>
<ol>
<li><p>可能需要安装的软件（因为我拿到手的时候，发现系统里已经有了，不知道是某宝的亲帮我装的，还是raspbian已经预装了）</p>
<pre><code>sudo apt-get install wireless-tools
</code></pre></li>
<li><p>然后可以开始配置网络了，修改<strong>/etc/network/interfaces</strong>文件，把它修改成这个样子</p>
<pre><code>auto lo
iface lo inet loopback

auto eth0
iface eth0 inet dhcp

allow-hotplug wlan0
auto wlan0
iface wlan0 inet dhcp
    wpa-ssid YOUR-SSID-HERE
    wpa-psk YOUR-PASSWORD-HERE
</code></pre><p>主要是添加wpa-ssid和wpa-psk，直接把你要连接的wifi的ssid和对应密码写上就行了。</p>
</li>
<li><p>重启网络</p>
<pre><code>/etc/init.d/networking restart
# or: service networking restart
</code></pre><p>然后你应该就已经连上wifi了，如果没有连上：</p>
<ol>
<li>检查时候你要连接的wifi是不是隐藏的WiFi(不广播自己的ssid的WiFi网络)，这种配置方法没办法连接隐藏的WiFi。通过下面的命令检查你要连的WiFi是不是在列表里：<pre><code>iwlist wlan0 scan
</code></pre></li>
<li>检查你的ssid和密码是否正确！！！</li>
<li>检查你要连的wifi网络是否正常，检查你的USB无线网卡是不是正常</li>
<li>如果还连不上就google吧，我也无能为力了</li>
</ol>
</li>
</ol>
<p>这样的配置在你重新启动树莓派后也能自动连接这个WiFi，这里连接WiFi使用的是wpa_supplicant</p>
<h3 id="自动连接多个WiFi网络"><a href="#自动连接多个WiFi网络" class="headerlink" title="自动连接多个WiFi网络"></a>自动连接多个WiFi网络</h3><p>当你经常切换到不同WiFi网络中时，你可以配置多个WiFi网络，让树莓派能自动连接到可用WiFi网络中。这里就要用到高大上的wpa_supplicant.conf了</p>
<ol>
<li><p>修改<strong>/etc/wpa_supplicant/wpa_supplicant.conf</strong>，下面是我使用的配置文件：</p>
<pre><code>ctrl_interface=/var/run/wpa_supplicant
#ap_scan=1

network={
       ssid=&quot;wo_shi_yige_wifi_ssid&quot;
       scan_ssid=1
       psk=&quot;wo_shi_mi_ma&quot;
       priority=5
}

network={
       ssid=&quot;pi&quot;
       psk=&quot;onlyforpi&quot;
       priority=1
}
</code></pre><ul>
<li><strong>ap_scan:</strong>1是默认值，因此我注掉了<ul>
<li><strong>1：</strong>这个模式下总是先连接可见的WiFi，如果扫描完所有可见的网络之后都没有连接上，则开始连接隐藏WiFi。</li>
<li><strong>2：</strong>会按照network定义的顺序连接WiFi网络，遇到隐藏的将立刻开始连接，因此在这个模式下连接顺序不受priority影响</li>
</ul>
</li>
<li><strong>ctrl_interface:</strong>这个文件夹里面存的是一个当前使用的interface的socket文件，可以供其他程序使用读取WiFi状态信息</li>
<li><strong>network：</strong>是一个连接一个WiFi网络的配置，可以有多个，wpa_supplicant会按照priority指定的优先级（数字越大越先连接）来连接，当然，在这个列表里面隐藏WiFi不受priority的影响，隐藏WiFi总是在可见WiFi不能连接时才开始连接。<ul>
<li><strong>ssid</strong>:网络的ssid</li>
<li><strong>psk</strong>:密码</li>
<li><strong>priority</strong>:连接优先级，越大越优先</li>
<li><strong>scan_ssid:连接隐藏WiFi时需要指定该值为1</strong></li>
</ul>
</li>
</ul>
</li>
<li><p>修改/etc/network/interfaces使用wpa_supplicant.conf来配置无线网络</p>
<pre><code>auto lo
iface lo inet loopback

auto eth0
iface eth0 inet dhcp

allow-hotplug wlan0
auto wlan0
iface wlan0 inet dhcp
    pre-up wpa_supplicant -Dwext -i wlan0 -c /etc/wpa_supplicant/wpa_supplicant.conf -B    
</code></pre><p>以后每次启动时，树莓派都会主动去连接配置文件中预定义的这些wifi网络。  </p>
</li>
</ol>
<p>在这个配置里面有一个<strong>ssid=’pi’</strong>网络，这是一个最低优先级网络，是用来在陌生网络中配置树莓派的。当处在一个树莓派配置里面的没有的WiFi网络中时，我会自己创建一个叫pi的WiFi，当其他网络都不可用时，树莓派连到这个网络里，然后我便可以ssh进树莓派，添加网络配置，然后重启，就可以让树莓派加入到新的网络中。</p>
<h3 id="让树莓派告诉你它的IP（软件的方式）"><a href="#让树莓派告诉你它的IP（软件的方式）" class="headerlink" title="让树莓派告诉你它的IP（软件的方式）"></a>让树莓派告诉你它的IP（软件的方式）</h3><p>那么如何在你的树莓派加入新的网络后获取到它当前的ip地址呢？因为你在重新配置树莓派的网络并重启后，你跟树莓派的连接会断掉，因此你需要知道树莓派在新网络中的ip，从而使你能重新连接到树莓派。在网上很多免费提供的域名解析服务，你可以某个域名解析成你设置的ip地址。每次树莓派启动后都会更新自己的域名对应的ip，我是用的<a href="https://www.dnsdynamic.org" target="_blank" rel="external">DNSDynamic</a>提供的服务，进行简单的设置就OK了。</p>
<ol>
<li>注册账号~~~~</li>
<li><p>设置一个启动脚本来获取本机ip并且更新到DNSDynamic上：</p>
<ul>
<li><p>修改/etc/rc.local，添加如下内容：    </p>
<pre><code>IP=`hostname -I`
EMAIL=your_username_in_dnsdynamic
PASSWORD=your_password
DOMAIN=your_registered_domain.dnsdynamic.com
curl -v --user &quot;$EMAIL:$PASSWORD&quot; -k &quot;https://www.dnsdynamic.org/api/?hostname=$DOMAIN&amp;myip=$IP&quot; &gt; /var/log/update-dns.log 2&gt;&amp;1
</code></pre></li>
</ul>
</li>
</ol>
<p>脚本后面的内容是调用dnsdynamic提供的api更新域名对应的ip地址</p>
<p>每一次树莓派启动之后都会执行这个脚本更新自己的ip地址，也可以将这段脚添加到cron job里定时更新ip,但是感觉好像没有必要。</p>
<ol>
<li><p>之后你就不用管ip地址了，可以通过域名直接ssh进树莓派：</p>
<pre><code>ssh pi@your_registered_domain.dnsdynamic.com
</code></pre></li>
</ol>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>上面的提供的方案其实一定程度依赖于网络（internet），如果树莓派连接到的wifi是没有internet连接的，那么就没办法通过dnsdynamic更新ip了，那么我们也就没有办法获取到它当前的ip，除非它使用静态ip.<br>在failover的网络（上面设置的名叫pi的wifi）设置上也可以通过另一个方式，就是在树莓派启动之后可以自己开启一个wifi AP，然后我们可以连接进去，进而做各种设置，arduino最新的板子arduino yun就是通过这种方式进行设置的。</p>
<p><img src="/images/post_images/raspi.jpg" alt="raspi"></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  


          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/uploads/avatar.png"
               alt="王超" />
          <p class="site-author-name" itemprop="name">王超</p>
          <p class="site-description motion-element" itemprop="description">享受技术和编程带来的快乐</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">5</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              
                <span class="site-state-item-count">2</span>
                <span class="site-state-item-name">分类</span>
              
            </div>
          

          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/charleyw" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
          
        </div>

        
        

        
        

      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">王超</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.0.1"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  



  




  
  

  

  

  

</body>
</html>
